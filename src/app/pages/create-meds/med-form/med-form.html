<div class="max-w-3xl mx-auto">
  <h1 class="text-3xl font-bold tracking-tight mb-8">Crear Medicamento</h1>

  <div class="bg-white rounded-xl shadow-sm border border-primary/10 p-6 sm:p-8">
    <form [formGroup]="medForm"
          (ngSubmit)="onSubmit()"
          class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-6">
      <!-- ID -->
      <div>
        <label class="block text-sm font-medium mb-1" for="id">Identificaci&oacute;n</label>
        <input
          class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50"
          formControlName="id"
          id="id"
          placeholder="e.g., 123"
          type="number"
          readonly
        />
      </div>

      <!-- Fecha -->
      <div>
        <label class="block text-sm font-medium mb-1" for="date">Fecha</label>
        <input
          (change)="onDateChange($event)"
          [value]="medForm.controls.date.value | date:'yyyy-MM-dd'"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50"
          id="date"
          type="date"
          required
        />
        @if (medForm.controls.date.touched && medForm.controls.date.invalid) {
          <p class="mt-1 text-xs text-red-600">La fecha es obligatoria.</p>
        }
      </div>

      <!-- Nombre -->
      <div class="md:col-span-2">
        <label class="block text-sm font-medium mb-1" for="name">Nombre</label>
        <input
          class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50"
          formControlName="name"
          id="name"
          placeholder="Nombre del medicamento"
          type="text"
          required
        />
        @if (medForm.controls.name.touched && medForm.controls.name.invalid) {
          <p class="mt-1 text-xs text-red-600">El nombre es obligatorio.</p>
        }
      </div>

      <!-- Costo -->
      <div>
        <label class="block text-sm font-medium mb-1" for="cost">Costo (₡)</label>
        <input
          (blur)="onCostBlur($event)"
          (focus)="onCostFocus($event)"
          (input)="onCostInput($event)"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50"
          formControlName="cost"
          id="cost"
          inputmode="decimal"
          placeholder="e.g., ₡ 12.345,67"
          type="text"
        />
      </div>

      <!-- Cantidad -->
      <div>
        <label class="block text-sm font-medium mb-1" for="quantity">Cantidad</label>
        <input
          class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50"
          formControlName="quantity"
          id="quantity"
          placeholder="e.g., 50"
          type="number"
          min="1"
          required
        />
        @if (medForm.controls.quantity.touched && medForm.controls.quantity.invalid) {
          <p class="mt-1 text-xs text-red-600">La cantidad es obligatoria y debe ser mayor o igual a 1.</p>
        }
      </div>

      <!-- Ubicación / Sede (full width) -->
      <div class="md:col-span-2">
        <label class="block text-sm font-medium mb-1" for="location">Ubicación / Sede</label>
        <select
          id="location"
          class="w-full px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-gray-50"
          formControlName="location"
          required
        >
          <option [ngValue]="null" disabled>Seleccione una Sede</option>
          @for (location of locations; track location.id) {
            <option [ngValue]="location.id">{{ location.name }}</option>
          }
        </select>
        @if (medForm.controls.location.touched && medForm.controls.location.invalid) {
          <p class="mt-1 text-xs text-red-600">La ubicación es obligatoria. Seleccione una sede.</p>
        }
      </div>

      <!-- Actions -->
      <div class="md:col-span-2 mt-2 flex justify-end gap-4">
        <button
          (click)="onReset()"
          class="px-6 py-2.5 rounded-lg text-sm font-semibold bg-gray-100 border border-gray-300 text-gray-700 hover:bg-gray-200 transition-colors"
          type="button">
          Cancelar
        </button>
        <button
          [disabled]="medForm.invalid"
          class="px-6 py-2.5 rounded-lg text-sm font-semibold bg-blue-600 text-white hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed"
          type="submit">
          Guardar
        </button>
      </div>

      <!--
      <pre>{{ medForm.value | json }}</pre>
      -->

    </form>
  </div>
</div>
